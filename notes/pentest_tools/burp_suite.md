# Burp Suite

## Install / Other Sections

- There's a bunch of steps for installing it, I'm not gonna take notes on that lol
- There is some steps also for adding the CA certificate and the proxy. Looks like you just add a proxy (HTTP 127.0.0.1:8080) (they did it by installing FoxyProxy for Firefox and using that), then navigating to localhost:8080, downloading the cert, then importing it into Firefox
- There's a dark mode, I turned it on...
  - I might to be able to theme this maybe? That would be cool
- Extender essentially is just add ons for Burp Suite. Requires [Jython](https://www.jython.org/download.html)
  - Some recommended ones:
    - [Logger++](https://portswigger.net/bappstore/470b7057b86f41c396a97903377f3d81) - Adds enhanced logging to all requests and responses from all Burp Suite tools, enable this one before you need it
    - [Request Smuggler](https://portswigger.net/bappstore/aaaa60ef945341e8a450217a54a11646) - A relatively new extension, this allows you to attempt to smuggle requests to backend servers. See this talk by James Kettle for more details: [Link](https://www.youtube.com/watch?v=_A04msdplXs)
    - [Autorize](https://portswigger.net/bappstore/f9bbac8c4acf4aefa4d7dc92a991af2f) - Useful for authentication testing in web app tests. These tests typically revolve around navigating to restricted pages or issuing restricted GET requests with the session cookies of low-privileged users
    - [Burp Teams Server](https://github.com/Static-Flow/BurpSuite-Team-Extension) - Allows for collaboration on a Burp project amongst team members. Project details are shared in a chatroom-like format
    - [Retire.js](https://portswigger.net/bappstore/36238b534a78494db9bf2d03f112265c) - Adds scanner checks for outdated JavaScript libraries that contain vulnerabilities, this is a premium extension
    - [J2EEScan](https://portswigger.net/bappstore/7ec6d429fed04cdcb6243d8ba7358880) - Adds scanner test coverage for J2EE (java platform for web development) applications, this is a premium extension
    - [Request Timer](https://portswigger.net/bappstore/56675bcf2a804d3096465b2868ec1d65) - Captures response times for requests made by all Burp tools, useful for discovering timing attack vectors
    - [Others that Burp Suite recommends](https://portswigger.net/testers/penetration-testing-tools)

- The Scanner tool (premium only) allows you to actively and passively scan/spider the website being tested for vulns., which can be ran in the background. [A report](./burp_suite_task_files/report.html) can be generated, which can provide a starting place
- The Collaborator Client lets testers gain insight into issues that may not provide any output due to slowness/timing or just lack of a reaction (vulnerable but non-responsive). It produces out-of-band alerts via generating payloads that reach back to Burp Suite servers for us

## Overview of Features

There's a lot of sections!

- **Proxy**: allows us to funnel traffic through Burp Suite to look at it
- **Target**: sets the scope of the project, can help create a site map for the app we're looking at
- **Intruder**: tool for a lot of different intrusion things, like field fuzzing and credential stuffing
- **Repeater**: allows us to repeat requests we've made with or without modification. often used before fuzzy-ing
- **Sequencer**: analyzes 'randomness' present in a web app which is intended to be unpredictable, good for session cookies
- **Decoder**: performs various transforms on data, like url encoding
- **Comparer**: used to compare responses or other data (essentially `(git) diff`)
- **Extender**: adds components/integrations to requests (like scan definitions)
- **Scanner**: automated web vuln. scanner that highlights places an app might need intervention or that can be exploited (premium version only)

[Burp Suite Tool Docs](https://portswigger.net/burp/documentation/desktop/tools)

### Questions

- Which tool in Burp Suite can we use to perform a 'diff' on responses and other pieces of data? [_comparer_]
- What tool could we use to analyze randomness in different pieces of data such as password reset tokens? [_sequencer_]
- Which tool can we use to set the scope of our project? [_target_]
- While only available in the premium versions of Burp Suite, which tool can we use to automatically identify different vulnerabilities in the application we are examining? [_scanner_]
- Encoding or decoding data can be particularly useful when examining URL parameters or protections on a form, which tool allows us to do just that? [_decoder_]
- Which tool allows us to redirect our web traffic into Burp for further examination? [_proxy_]
- Simple in concept but powerful in execution, which tool allows us to reissue requests? [_repeater_]
- With four modes, which tool in Burp can we use for a variety of purposes such as field fuzzing? [_intruder_]
- Last but certainly not least, which tool allows us to modify Burp Suite via the addition of extensions? [_extender_]

## Proxies

Proxy servers allow us to relay traffic through an alternative route on the internet. Can be used for many reasons, like

- not showing your IP directly to a host
- blocking content (like ads or certain websites)
- accessing content that's region locked

In this application, it's used to analyze and modify traffic at a granular level (interception, request history, etc.)

By default, Burp is configured to intercept traffic, which means:

- requests will require our authorization to be sent by default
- we can modify requests in-line before sending them out (i.e. a man-in-the-middle attack)
- we can deny certain requests from being sent, which can be used to see the attempt after clicking a button or some other action
- we can send requests to other tools like Repeater and Intruder to modify/manipulate them

### Questions

- By default, the Burp Suite proxy listens on only one interface. What is it? Use the format of IP:PORT [`127.0.0.1:8080`]
- In Burp Suite, navigate to the Intercept sub-tab of the Proxy section. Enable Intercept
- Return to your web browser and navigate to the web application hosted on the VM we deployed just a bit ago. Note that the page appears to be continuously loading. Change back to Burp Suite, we now have a request that's waiting in our intercept tab. Take a look at the actions, which shortcut allows us to forward the request to Repeater? [_Ctrl-R_]
- How about if we wanted to forward our request to Intruder? [_Ctrl-I_]
- Burp Suite saves the history of requests sent through the proxy along with their varying details. This can be especially useful when we need to have proof of our actions throughout a penetration test or we want to modify and resend a request we sent a while back. What is the name of the first section wherein general web requests (GET/POST) are saved? [_HTTP History_]
- Defined in RFC 6455 as a low-latency communication protocol that doesn't require HTTP encapsulation, what is the name of the second section of our saved history in Burp Suite? These are commonly used in collaborate application which require real-time updates (Google Docs is an excellent example here). [_WebSockets History_]
- Before we move onto exploring our target definition, let's take a look at some of the advanced customization we can utilize in the Burp proxy. Move over to the Options section of the Proxy tab and scroll down to Intercept Client Requests. Here we can apply further fine-grained rules to define which requests we would like to intercept. Perhaps the most useful out of the default rules is our only AND rule. What is it's match type? [_URL_]
- How about it's 'Relationship'? In this situation, enabling this match rule can be incredibly useful following target definition as we can effectively leave intercept on permanently (unless we need to navigate without intercept) as it won't disturb sites which are outside of our scope - something which is particularly nice if we need to Google something in the same browser. [_Is in target scope_]

## Target Definition

The Target tab in Burp Suite (arguably one of the most important) allows us to define our scope, view a site map, and specify issue definitions

When performing a web app test, you'll usually be provided with:

- the app url (usually a dev/test url)
- list of user roles in the app
- test accounts and associated credentials
- list of pieces in the app that are out of scope

With that info, we can build a scope in Burp (which is important if automated testing is being done). If the app has multiple tiers, we work our way up from lowest to highest, browsing the site normally (aka the happy path). After creating a site map with the happy path, we can start to remove things from scope, which are defined by these criteria:

- The item was pointed out as out of scope from the developer
- Automated credentialed exploitation of the item would cause a massive mess (i.e. sending thousands of password reset emails) or cause the app to crash

Once the info is laid out, then we can move on to other tools

### Questions

- Before leaving the Proxy tab, switch Intercept to disabled. We'll still see the pages we navigate to in our history and the target tab, just having Intercept constantly stopping our requests for this next bit will get old fast.
- Navigate to the Target tab in Burp. In our last task, Proxy, we browsed to the website on our target machine (in this case OWASP Juice Shop). Find our target site in this list and right-click on it. Select 'Add to scope'. 
- Clicking 'Add to scope' will trigger a pop-up. This will stop Burp from sending out-of-scope items to our site map.
- Select 'Yes' to close the popup.
- Browse around the rest of the application to build out our page structure in the target tab. Once you've visited most of the pages of the site return to Burp Suite and expand the various levels of the application directory. What do we call this representation of the collective web application? [_site map_]
- What is the term for browsing the application as a normal user prior to examining it further? [_happy path_]
- One last thing before moving on. Within the target tab, you may have noticed a sub-tab for issue definitions. Click into that now.
- The issue definitions found here are how Burp Suite defines issues within reporting. While getting started, these issue definitions can be particularly helpful for understanding and categorizing various findings we might have. Which poisoning issue arises when an application behind a cache process input that is not included in the cache key? [_web cache poisoning_]

## Repeater

The Repeater allows us to repeat requests we've already made. They can be reissued as is or with modifications. It's usually used for experimentation or very-fine tuned exploitations where automation isn't helpful.

### Questions

- To start, click 'Account' (this might be 'Login' depending on the version of Juice Shop) in the top right corner of Juice Shop in order to navigate to the login page.
- Try logging in with invalid credentials. What error is generated when login fails? [_Invalid email or password._]
- But wait, didn't we want to send that request to Repeater? Even though we didn't send it to Repeater initially via intercept, we can still find the request in our history. Switch over to the HTTP sub-tab of Proxy. Look through these requests until you find our failed login attempt. Right-click on this request and send it to Repeater and then send it to Intruder, too!
- Now that we've sent the request to Repeater, let's try adjusting the request such that we are sending a single quote (') as both the email and password. What error is generated from this request? [`SQLITE_ERROR`]

```
Request:

POST /rest/user/login HTTP/1.1
Host: 10.10.226.227
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/json
Content-Length: 28
Origin: http://10.10.226.227
Connection: close
Referer: http://10.10.226.227/
Cookie: io=mGLS5iJ7wYcz5840AAAM; cookieconsent_status=dismiss; language=en

{"email":"'","password":"'"}

Response:

HTTP/1.1 500 Internal Server Error
X-Powered-By: Express
Access-Control-Allow-Origin: *
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Content-Type: application/json; charset=utf-8
Date: Tue, 20 Jul 2021 21:10:03 GMT
Connection: close
Content-Length: 1130

{
  "error": {
    "message": "SQLITE_ERROR: unrecognized token: \"3590cb8af0bbb9e78c343b52b93773c9\"",
    "stack": "SequelizeDatabaseError: SQLITE_ERROR: unrecognized token: \"3590cb8af0bbb9e78c343b52b93773c9\"\n    at Query.formatError (/home/ubuntu/juice-shop_8.2.0/node_modules/sequelize/lib/dialects/sqlite/query.js:423:16)\n    at afterExecute (/home/ubuntu/juice-shop_8.2.0/node_modules/sequelize/lib/dialects/sqlite/query.js:119:32)\n    at replacement (/home/ubuntu/juice-shop_8.2.0/node_modules/sqlite3/lib/trace.js:19:31)\n    at Statement.errBack (/home/ubuntu/juice-shop_8.2.0/node_modules/sqlite3/lib/sqlite3.js:16:21)",
    "name": "SequelizeDatabaseError",
    "parent": {
      "errno": 1,
      "code": "SQLITE_ERROR",
      "sql": "SELECT * FROM Users WHERE email = ''' AND password = '3590cb8af0bbb9e78c343b52b93773c9'"
    },
    "original": {
      "errno": 1,
      "code": "SQLITE_ERROR",
      "sql": "SELECT * FROM Users WHERE email = ''' AND password = '3590cb8af0bbb9e78c343b52b93773c9'"
    },
    "sql": "SELECT * FROM Users WHERE email = ''' AND password = '3590cb8af0bbb9e78c343b52b93773c9'"
  }
}
```

- Now that we've leveraged Repeater to gain proof of concept that Juice Shop's login is vulnerable to SQLi, let's try something a little more mischievous and attempt to leave a devastating zero-star review. First, click on the drawer button in the top-left of the application. If this isn't present for you, just skip to the next question.
- Next, click on 'Customer Feedback' (depending on the version of Juice Shop this also might be along the top of the page next to 'Login' under 'Contact Us')
- With the Burp proxy on submit feedback. Once this is done, find the POST request in your HTTP History in Burp and send it to Repeater.
- What field do we have to modify in order to submit a zero-star review? [_rating_]
- Submit a zero-star review and complete this challenge in Juice Shop!

```
Request:

POST /api/Feedbacks/ HTTP/1.1
Host: 10.10.226.227
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/json
Content-Length: 60
Origin: http://10.10.226.227
Connection: close
Referer: http://10.10.226.227/
Cookie: io=mGLS5iJ7wYcz5840AAAM; cookieconsent_status=dismiss; language=en; continueCode=qo61W2w2ZW6a3BeyxzDmjrPKlY5bAyD0LO4XpRqkJQ8VE7g1ovNMn9kZ9wrE

{"captchaId":2,"captcha":"-2","comment":"apples","rating":0}

Response:

HTTP/1.1 201 Created
X-Powered-By: Express
Access-Control-Allow-Origin: *
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Location: /api/Feedbacks/9
Content-Type: application/json; charset=utf-8
Content-Length: 158
ETag: W/"9e-yUSEeZLnqjfl83U2RiKiHy1ycfg"
Date: Tue, 20 Jul 2021 21:14:18 GMT
Connection: close

{"status":"success","data":{"id":9,"comment":"apples","rating":0,"updatedAt":"2021-07-20T21:14:18.179Z","createdAt":"2021-07-20T21:14:18.179Z","UserId":null}}
```

## Intruder

[Task File - Wordlist of SQL Injection Strings](./burp_suite_task_files/xplatform-shortened.txt)

Intruder is arguably the most powerful feature in Burp Suite _(I guess it isn't the most important then? You said it was Target earlier lol)_

Intruder automates the exploitation process (which differs from Repeater which is more for one-off, manual testing or for a proof of concept). Based on the linked docs earlier, some common uses are:

- Enumerating usernames/emails, cycling through predictable session/password recovery tokens, simple password guessing, etc.
- Harvesting useful data from user profiles or other pages
- Fuzzing for common vulns like SQL Injection, Cross Site Scripting (XSS), file path traversal, etc.

Intruder has 4 different attack types:

- **Sniper**: (most popular) cycles through selected positions, putting the next available payload (in our case, an item from the wordlist) in each position in turn. Only uses one set of payloads (i.e. one file)
- **Battering Ram**: Also only uses one set of payloads. Similar to Sniper, except it puts every payload into every selected position.
- **Pitchfork**: Allows for using multiple payload sets (one per position selected) and iterate through them simultaneously, once per line. (i.e. a username list for the username field and a password list for the password field). It'll cycle through combinations, totaling in the smallest payload set (goes linearly: set 1 line 1 and set 2 line 1, then set 1 line 2 and set 2 line 2, and so on...)
- **Cluster Bomb**: The same as Pitchfork, except it tries all combinations (total size of set 1 * total size of set 2), not just line by line. Can take a while if using the free version of Burp Suite

### Questions

- Which attack type allows us to select multiple payload sets (one per position) and iterate through them simultaneously? [_pitchfork_]
- How about the attack type which allows us to use one payload set in every single position we've selected simultaneously? [_battering ram_]
- Which attack type allows us to select multiple payload sets (one per position) and iterate through all possible combinations? [_cluster bomb_]
- Perhaps the most commonly used, which attack type allows us to cycle through our payload set, putting the next available payload in each position in turn? [_sniper_]
- Download the wordlist attached to this room, this is a shortened version of the fuzzdb SQLi platform detection list.
- Return to the Intruder in Burp. In our previous task, we passed our failed login attempt to both Repeater and Intruder for further examination. Open up the Positions sub-tab in the Intruder tab with this request now and verify that 'Sniper' is selected as our attack type.
- Burp attempts to automatically highlight possible fields of interest for Intruder, however, it doesn't have it quite right for what we'll be looking at in this instance. Hit 'Clear' on the right-hand side to clear all selected fields.
- Next, let's highlight the email field between the double quotes ("). This will be whatever you entered in the email field for our previous failed login attempt.
- Now click 'Add' to select our email field as a position for our payloads.
- Next, let's switch to the payloads sub-tab of Intruder. Once there, hit 'Load' and select the wordlist you previously downloaded in question five that is attached to this task.
- Almost there! Scroll down and uncheck 'URL-encode these characters'. We don't want to have the characters sent in our payloads to be encoded as they otherwise won't be recognized by SQL.
- Finally, click 'Start attack'. What is the first payload that returns a 200 status code, showing that we have successfully bypassed authentication? [`a' or 1=1--`]

```
Request:

POST /rest/user/login HTTP/1.1
Host: 10.10.226.227
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/json
Content-Length: 45
Origin: http://10.10.226.227
Connection: close
Referer: http://10.10.226.227/
Cookie: io=mGLS5iJ7wYcz5840AAAM; cookieconsent_status=dismiss; language=en

{"email":"a' or 1=1--","password":"password"}

Response:

HTTP/1.1 200 OK
X-Powered-By: Express
Access-Control-Allow-Origin: *
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Content-Type: application/json; charset=utf-8
Content-Length: 698
ETag: W/"2ba-53SstnURapzo1m2mSnS+exLyxro"
Date: Tue, 20 Jul 2021 22:41:27 GMT
Connection: close

{"authentication":{"token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6MSwidXNlcm5hbWUiOiIiLCJlbWFpbCI6ImFkbWluQGp1aWNlLXNoLm9wIiwicGFzc3dvcmQiOiIwMTkyMDIzYTdiYmQ3MzI1MDUxNmYwNjlkZjE4YjUwMCIsImlzQWRtaW4iOnRydWUsImxhc3RMb2dpbklwIjoiMC4wLjAuMCIsInByb2ZpbGVJbWFnZSI6ImRlZmF1bHQuc3ZnIiwiY3JlYXRlZEF0IjoiMjAyMS0wNy0yMCAyMDowMDoxMy43NTUgKzAwOjAwIiwidXBkYXRlZEF0IjoiMjAyMS0wNy0yMCAyMDowMDoxMy43NTUgKzAwOjAwIn0sImlhdCI6MTYyNjgyMDg4NywiZXhwIjoxNjI2ODM4ODg3fQ.GrMac33yoiHqxT0S6MuU8-bU3bkhKFMGk7gL2dKgxx7T0yzf3QK4eOo4kvnSC_hFF7MTgI1briewiWQALEjbSxXE3zm8uvFteiMKaRHOVBM9j94XiDpJFjc3uKxTNJCNS7ZfMXqX_roBpGIRDQxEX-Yh6v8_Bf8BSn3TCMnHWJ0","bid":1,"umail":"admin@juice-sh.op"}}
```

## Sequencer

Sequencer is a tool for analyzing randomness of an app's session tokens and other important items that are meant to be unpredictable (i.e. session tokens, anti-cross-site-request forgery tokens (Anti-CSRF), password reset tokens, etc.). It's not commonly used in testing environments, but they can be useful

### Questions

- Switch over to the HTTP history sub-tab of Proxy.
- We're going to dig for a response which issues a cookie. Parse through the various responses we've received from Juice Shop until you find one that includes a 'Set-Cookie' header.
- Once you've found a request response that issues a cookie, right-click on the request and select 'Send to Sequencer'.
- Change over Sequencer and select 'Start live capture'
- Let Sequencer run and collect ~10,000 requests. Once it hits roughly that amount hit 'Pause' and then 'Analyze now'
- Parse through the results. What is the effective estimated entropy measured in? [``]
- In order to find the usable bits of entropy we often have to make some adjustments to have a normalized dataset. What item is converted in this process? [``]
- Read through the remaining results of the token analysis

## Decoder and Comparer

Decoder is a tool that performs various transforms on data, which may involve encoding/decoding various bases or URL encoding. You can chain decodes together, and Decoder will add a new tier each time a transform occurs.

Comparer allows you to compare different responses or other pieces of data (site maps, proxy histories, etc.). It's essentially `diff`. Common uses for Comparer:

- Username enumeration, looking at responses for valid and invalid credentials to find subtile differences
- Intruder attacks with different length responses
- Site maps or proxy histories generated by different types of users. Can compare pairs of similar requests to see where the differences are, which can reveal what info is given to users of specific authorization levels or roles, which can reveal access issues in applications
- Blind SQL injection bugs using Boolean condition injection and other requests, checking to see if different injection techniques give different info

### Questions

- Let's first take a look at decoder by revisiting an old friend. Previously we discovered the scoreboard within the site JavaScript. Return to our target tab and find the API endpoint highlighted in the following request:
- Copy the first line of that request and paste it into Decoder. Next, select 'Decode as ...' URL
- What character does the %20 in the request we copied into Decoder decode as? [__]
- Similar to CyberChef, Decoder also has a 'Magic' mode where it will automatically attempt to decode the input it is provided. What is this mode called? [__]
- What can we load into Comparer to see differences in what various user roles can access? This is very useful to check for access control issues. [__]
- Comparer can perform a diff against two different metrics, which one allows us to examine the data loaded in as-is rather than breaking it down into bytes? [__]

## Extra Info

- [Port Swigger Web Security Academy](https://portswigger.net/web-security)
- SANS WebApp Pentest Courses
  - [SEC 542](https://www.sans.org/course/web-app-penetration-testing-ethical-hacking)
  - [SEC 642](https://www.sans.org/course/advanced-web-app-penetration-testing-ethical-hacking)

- [CyberCher Decoder](https://gchq.github.io/CyberChef/)