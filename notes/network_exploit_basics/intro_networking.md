# Intro to Networking

## Open Systems Interconnection (OSI)

- a standardized model to explain networking
- 7 layers
    - (7) Application - provides networking options to programs running on a box
        * works exclusively with apps, providing an interface for them to use in order to transmit data
        * i.e. a REST API
    - (6) Presentation - receives data from the app layer in a format the app understands (doesn't have to be a standardized format for apps in the receiving layer)
        * translates data into a standardized format, and handles any extra steps (encryption, compression, etc.)
        * i.e. a web server
    - (5) Session - receives formatted data from the presentation layer, tries to set up a connection to another box across the network (errors/stops if it fails)
        * if successful, it keeps the session open with the other communicating box
    - (4) Transport - receives data from the session layer after a connection is established. It chooses between two different protocols
        * Transmission Control Protocol (TCP) - transmission is connection based (a connection between boxes is established and maintained for the duration of the request)
            - ensures *all* packets make it to the correct place
            - allows two boxes to remain in constant communication to ensure data is sent at an acceptable speed, and any lost data is re-sent
            - preferred when accuracy is more important
            - i.e. file transfer, website, REST API
        * User Datagram Protocol (UDP) - packets of data are thrown at the other box with no regard to connection or if the other box is listening
            - preferred when speed is more important
            - i.e. a video call, YouTube videos
    - (3) Network - takes bite-sized data (segments for TCP; datagrams for UDP) from the transport layer and locates the destination box via logical addressing (i.e. IPv4); the system that decides the best route based on the destination's IP request
    - (2) Data Link - takes data from the networking layer and links it to the physical address
        * uses a Media Access Control address (MAC address) from a Network Interface Card (NIC)
            - MAC addresses are burned onto the cards. They cannot be changed but they can be spoofed
        * also presents the transmitted data in a suitable format and ensures it isn't corrupted
    - (1) Physical - essentially a computer. Takes data from the data link layer and processes it
        * This is where the electrical pulses that make up data transfer over a network are sent and received. It's the job of the physical layer to convert the binary data of the transmission into signals and transmit them across the network, as well as receiving incoming signals and converting them back into binary data.

### Questions

1. Which layer would choose to send data over TCP or UDP? [*Transport*]
2. Which layer checks received packets to make sure that they haven't been corrupted? [*Data Link*]
3. In which layer would data be formatted in preparation for transmission? [*Data Link*]
4. Which layer transmits and receives data? [*Physical*]
5. Which layer encrypts, compresses, or otherwise transforms the initial data to give it a standardized format?[*Presentation*]
6. Which layer accepts communication requests from applications? [*Application*]
7. Which layer handles logical addressing? [*Network*]
8. When sending data over TCP, what would you call the "bite-sized" pieces of data? [*segments*]
9. [Research] Which layer would the FTP protocol communicate with? [*Application*]
    - Google search: `ftp communication layer`
    - Found: [Wikipedia Article with OSI layer](https://en.wikipedia.org/wiki/File_Transfer_Protocol)
10. Which transport layer protocol would be best suited to transmit a live video? [*UDP*]

## Encapsulation

-   As data is passed down through the layers, more info containing data is added to the start of the transmission
-   i.e. The data gets a header from the app, then another header from the presentation layer, then another header from the session layer and so on and so on
-   i.e. Network layer would add on source and destination IPs, transport layer would add on protocol-specific info, etc.
-   The data link layer also adds a footer/trailer which is used to verify that data isn't corrupt, which adds more security because data can't be tampered with without breaking the footer
-   The entire process of moving through the layers with the addition of headers/footers is called _encapsulation_

![Encapsulation diagram](https://muirlandoracle.co.uk/wp-content/uploads/2020/02/image.jpeg)

-   Data is given different names in different layers
    -   App, presentation, and session layers just call it _data_
    -   The transport layer call it either _segments_ (TCP) or _datagrams_ (UDP)
    -   The networking layer calls it _packets_
    -   The data link layer calls it _frames_
    -   The physical layer calls it _bits_
-   When the message is received by another box, the process is reversed. Start with bits, then go to frames, and so on, stripping off the areas as it goes. Called _de-encapsulation_..... <small><em>shocker...</em></small>
-   The layers of the OSI model exist in every computer with a network connection
-   Encapsulation and the reverse process give an absolute standard about how data should be sent, meaning everything follows the general OSI model

### Questions

1. How would you refer to data at layer 2 of the encapsulation process (with the OSI model)? [*Frames*]
2. How would you refer to data at layer 4 of the encapsulation process (with the OSI model), if the UDP protocol has been selected? [*Datagrams*]
3. What process would a computer perform on a received message? [*De-encapsulation*]
4. Which is the only layer of the OSI model to add a trailer during encapsulation? [*Data Link*]
5. Does encapsulation provide an extra layer of security? [*Yes*]

## TCP/IP

-   A slightly older yet still used real world model. Very similar to the OSI model.

-   Only has 4 layers

    -   Application - combines the OSI app, presentation, and session layers
    -   Transport - same as the OSI model
    -   Internet - same as the network layer in the OSI model
    -   Network Interface - combines the OSI data link and physical layers
        -   _some models separate out the data link and physical layers, but it isn't official. Either one is fine_

-   OSI is good for learning, TCP/IP is used in real world application
-   Encapsulation and de-encapsulation work the exact same way in TCP/IP
-   TCP/IP is actually a set of protocols/rules about how actions should be carried out
-   TCP uses a 3 way handshake before sending data to confirm a connection is ready to receive data
    -   To make a connection, the sender will send out a synchronize bit (SYN) to inform the receiver that it wants to start a connection
    -   The receiver will then send out a packet with the SYN bit, and then send out an acknowledgment bit (ACK)
    -   The sender will then send back out the ACK bit to the receiver

![Three way handshake](https://muirlandoracle.co.uk/wp-content/uploads/2020/03/image-2.png)

-   This process ensures the connection won't be broken until all data is sent
-   History
    -   TCP/IP was introduced in 1982 to set a standard for sending data over networks
    -   OSI was made later on by the International Organization for Standardization but is used for mostly learning

### Questions

1. Which model was introduced first, OSI or TCP/IP? [*TCP/IP*]
2. Which layer of the TCP/IP model covers the functionality of the Transport layer of the OSI model? [*Transport*]
3. Which layer of the TCP/IP model covers the functionality of the Session layer of the OSI model? [*Application*]
4. The Network Interface layer of the TCP/IP model covers the functionality of two layers in the OSI model. These layers are Data Link, and? [*Physical*]
5. Which layer of the TCP/IP model handles the functionality of the OSI network layer? [*Internet*]
6. What kind of protocol is TCP? [*Connection-based*]
7. What is SYN short for? [*Synchronize*]
8. What is the second step of the three way handshake? [*SYN/ACK*]
9. What is the short name for the "Acknowledgment" segment in the three-way handshake? [*ACK*]

## `ping`

-   Just tests if a connection to a remote machine is possible
-   Uses ICMP protocol, slightly less well-known TCP/IP variant
    -   Uses internet layer from TCP/IP (network layer on OSI)
-   Secondarily, can give an IPv4 for a domain name (by default, can be configured to give IPv6)
-   Basic use: `ping <target>`

### Questions

1. What command would you use to ping the bbc.co.uk website? [`ping bbc.co.uk`]
2. Ping muirlandoracle.co.uk. What is the IPv4 address? [`217.160.0.152`]

```
PING muirlandoracle.co.uk (217.160.0.152) 56(84) bytes of data.
64 bytes from 217-160-0-152.elastic-ssl.ui-r.com (217.160.0.152): icmp_seq=1 ttl=49 time=125 ms
```

Using `man ping`

3. What switch lets you change the interval of sent ping requests? [`-i`]
4. What switch would allow you to restrict requests to IPv4? [`-4`]
5. What switch would give you a more verbose output? [`-v`]

## `traceroute`

-   Maps the path a ping takes from the source machine to the destination machine
-   Gives address of every server that a request goes through with time and other results
-   The Windows version (`tracert`) uses ICMP/TCP, the Linux version uses UDP (but can be switched if wanted)
-   Basic use: `traceroute <destination>`

### Questions

1. Use traceroute on tryhackme.com

From my WSL instance

```
‚ùØ traceroute tryhackme.com
traceroute to tryhackme.com (104.26.10.229), 30 hops max, 60 byte packets
 1  YAKPC.mshome.net (172.21.112.1)  0.208 ms  0.203 ms  0.181 ms
 2  dsldevice.attlocal.net (192.168.1.254)  0.778 ms  0.827 ms  0.802 ms
 3  162-237-100-1.lightspeed.clmboh.sbcglobal.net (162.237.100.1)  1.884 ms  1.814 ms  1.813 ms
 4  71.151.141.204 (71.151.141.204)  1.862 ms  1.796 ms  2.314 ms
 5  12.240.216.250 (12.240.216.250)  19.189 ms  19.153 ms  19.064 ms
 6  cgcil401igs.ip.att.net (12.122.133.105)  19.040 ms  15.719 ms  15.620 ms
 7  ae16.cr7-chi1.ip4.gtt.net (173.241.128.29)  15.757 ms  11.660 ms  11.609 ms
 8  ae21.cr9-chi1.ip4.gtt.net (141.136.108.245)  11.618 ms  12.742 ms  11.452 ms
 9  ip4.gtt.net (208.116.131.178)  15.444 ms  15.385 ms  15.386 ms
10  * 172.70.124.2 (172.70.124.2)  45.883 ms *
11  104.26.10.229 (104.26.10.229)  12.354 ms  12.290 ms  12.364 ms
```

Using `man traceroute`

2. What switch would you use to specify an interface when using Traceroute? [`-i`]
3. What switch would you use if you wanted to use TCP SYN requests when tracing the route? [`-T`]
4. [Lateral Thinking] Which layer of the TCP/IP model will traceroute run on by default (Windows)? [*Internet*]
    - It's running on Windows using an ICMP echo request (a type of TCP request). TCP requests occur on the Transport OSI layer. Because of this, it would be on the [*Internet*] layer.

## `whois`

-   Used to find more information about a certain domain name (IP, owner based on the registrar, etc.)
-   Basic use: `whois <domain>`

### Questions

1. Perform a whois search on facebook.com [*Too long to put here, ran using* `whois facebook.com`]
2. What is the registrant postal code for facebook.com? [`94025`]
3. When was the facebook.com domain first registered? [`03/29/1997`]
4. Perform a whois search on microsoft.com [*Same as question 1, ran using* `whois microsoft.com`]
5. Which city is the registrant based in? [`Redmond`]
6. [OSINT] What is the name of the golf course that is near the registrant address for microsoft.com? [*Google Maps said* `Bellevue Golf Course`]
7. What is the registered Tech Email for microsoft.com? [`msnhst@microsoft.com`]

## `dig`

-   IPs can be turned into URLs/domains using a Domain Name System (DNS)
-   DNS allows a special server to give the IP of a certain domain
-   Steps browser takes for URL
    -   First checks for IP in cache
    -   If nothing in cache, then it checks a _recursive DNS server_
        -   Usually maintained by ISPs, but also by companies like OpenDNS and Google
        -   Details of a URL are kept in the router
        -   Server also keeps a cache of popular URLs/IPs
        -   Only 13 existed before 2004. More now, but still accessible using the same 13 IPs assigned to the original servers
            -   Balanced so that you get the closest one when making a request
        -   Root name servers keep track of DNS servers in the next level down
    -   Next level down is called Top-Level Domain (TLD) servers, which are split up into extensions
        -   Essentially, the .com, .org, etc. part of the URL
    -   Next level down is called Authoritative Name Servers
        -   Stores DNS records for domains directly. Every domain in the world has it's DNS record there. Essentially the database
        -   Sends back up the relevant info for a browser to connect to
-   Browsers do it automatically. `dig` does this process manually.
    -   Manually queries recursive DNS servers for domain info.
    -   Good for troubleshooting
-   Basic use: `dig <domain> @<dns-server-ip>`
    -   Most interested in the `ANSWER` section
    -   Other sections
        -   `status` shows the status. `NOERROR` should hopefully be it
        -   `QUERY` shows how many queries were ran
        -   `TTL` (Time To Live) [number next to the URL in the `ANSWER SECTION`] shows when the computer should show when the record is no longer valid in number of seconds (when it should request again vs looking to cache)

### Questions

1. What is DNS short for? [*Domain Name System*]
2. What is the first type of DNS server your computer would query when you search for a domain? [*Recursive*]
3. What type of DNS server contains records specific to domain extensions (i.e. .com, .co.uk, etc)? [*Top-Level Domain*]
4. Where is the very first place your computer would look to find the IP address of a domain? [*Local Cache*]
5. [Research] Google runs two public DNS servers. One of them can be queried with the IP 8.8.8.8, what is the IP address of the other one? [`8.8.4.4`]
    - Google search: `google dns servers`
    - Found: [Google Dev DNS Docs](https://developers.google.com/speed/public-dns/docs/using)
6. If a DNS query has a TTL of 24 hours, what number would the dig query show? [`86400`]
    - `24 hours * 60 minutes in an hour * 60 seconds in a minute = 86400 seconds`
    
## Recommended Resources

- [CISCO CCNA Study Guide](http://citeseerx.ist.psu.edu/viewdoc/download?rep=rep1&type=pdf&doi=10.1.1.174.5012)
    + Older and geared towards the CCNA certificate but still relevant for studying topics. THM recommended one on Amazon but Penn State has a free copy. Fuck you Jeff Bezos
